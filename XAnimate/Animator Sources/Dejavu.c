/*--------------------------------- * The Animator * Copyright 1988 by David A. Smith * All Rights Reserved * 111 Gold Meadow Dr. * Cary, NC 27513 *---------------------------------*/#define EXT extern #include "adefs.h"WindowRecord theRecord;/*--------------------------------------------------------------------- *--------------------------------------------------------------------- */#define BSIZE 22InitDejaVu(){int i,wd,c;Rect r;SetRect(&r, 92, 40, 509, 334);theWindow = NewWindow( &theRecord , &r, "\pScene",1, 0, -1L, 0, 0L);SetPort(theWindow);PenMode(8);SetOrigin(0,0);MakeGrafPort(&size,&meta0);SetPort(&meta0);ClipRect(&size);FillRect(&size,white);MoveTo(0,HEIGHT-BTOP);LineTo(WIDTH,HEIGHT-BTOP);TextFont(0);DrawDButtons();DrawBackGround(&meta0);DrawPlane();/*draw in the foreground*/SetPort( theWindow );DejaCopy();cnum=0;dbutton[0].left=5;dbutton[0].right=5+BSIZE-2;dbutton[0].top=HEIGHT+5-BTOP;dbutton[0].bottom=HEIGHT+BSIZE-(BTOP-3);for(i=1;i<NUMBUTS;i++)	{	dbutton[i].top=dbutton[0].top;	dbutton[i].bottom=dbutton[0].bottom;	dbutton[i].left=dbutton[i-1].right+3;	dbutton[i].right=dbutton[i].left+BSIZE-2;	}InvertRect(&dbutton[cnum]);}/*--------------------------------------------------------------------- *--------------------------------------------------------------------- */DrawDButtons(){PicHandle Butt;Rect buttR;int xSize,ySize;Butt=GetPicture(1004);SizeRect(&xSize,&ySize,&(**Butt).picFrame);SetRect(&buttR,4,HEIGHT+4-BTOP,4+xSize,HEIGHT+4+ySize-BTOP);DrawPicture(Butt,&buttR);}/*--------------------------------------------------------------------- *--------------------------------------------------------------------- */DejaVu(){Point p;int i;Rect r,dummy;SetPort(theWindow);if(Button())	{	GetMouse(&p);	if(p.v>HEIGHT-BTOP)DejaButton();	else DoSPlanes(&p,cnum);	}}/*--------------------------------------------------------------------- *--------------------------------------------------------------------- */DejaButton(){int i,j,onoff;Point p;GrafPtr	savePort;int ch=0;GetPort( &savePort );SetPort(theWindow);onoff=FALSE;GetMouse(&p);for(i=0;i<8;i++)	{	if(p.h>dbutton[i].left &&		p.h<dbutton[i].right &&		p.v>dbutton[i].top &&		p.v<dbutton[i].bottom)		{		if(cnum!=i)			{			InvertRect(&dbutton[cnum]);			cnum=i;			InvertRect(&dbutton[cnum]);			SetCursor(*(Curs[cnum]));			}		FlushEvents(mDownMask|mUpMask|keyDownMask|keyUpMask|autoKeyMask,0);		SetPort(savePort);		}	}SetPort(savePort);}/*--------------------------------------------------------------------- *--------------------------------------------------------------------- */DejaCopy(){GrafPtr	savePort;DrawRect();GetPort( &savePort );SetPort(theWindow);CopyBits(&meta0.portBits,&theWindow->portBits,	&size,&size,srcCopy,NIL);SetPort( savePort );}/*--------------------------------------------------------------------- *--------------------------------------------------------------------- */DejaDCopy(){GrafPtr	savePort;DrawRect();GetPort( &savePort );SetPort(theWindow);CopyBits(&meta0.portBits,&theWindow->portBits,	&DClip,&DClip,srcCopy,NIL);SetPort( savePort );}/*----------------------------------------------------------------------  * sizerect(sx,sy,pr) * int *sx,*sy; * rect *pr; * copies size of rect to sx and sy *----------------------------------------------------------------------  */SizeRect(sx,sy,r)Rect *r;int *sx,*sy;{*sy=r->bottom-r->top;*sx=r->right-r->left;}/*----------------------------------------------------------------------  * CopyRect(rTo,rFrom) * copies rect to rect *----------------------------------------------------------------------  */CopyRect(rTo,rFrom)Rect *rFrom,*rTo;{rTo->top=rFrom->top;rTo->left=rFrom->left;rTo->bottom=rFrom->bottom;rTo->right=rFrom->right;}/*----------------------------------------------------------------------  * MakeButton(Rect *r) *----------------------------------------------------------------------  */MakeButton(pr,dbtext)Rect *pr;char * dbtext;{int x,y;FontInfo info;FrameRoundRect(pr,10,10);x=(pr->right+pr->left)/2;x-=StringWidth(dbtext)/2;GetFontInfo(&info);y=(pr->top+pr->bottom)/2;y-=(info.ascent+info.descent+info.leading)/2;MoveTo(x,y);DrawString(dbtext);}/*----------------------------------------------------------------------  * GrayRect(Point *p,Rect *r) *----------------------------------------------------------------------  */GrayRect(p,r)Point *p;Rect *r;{Point new,old;r->top=r->bottom=p->v;r->left=r->right=p->h;GetMouse(&old);MaxRect(r,&rBounds,p->v,p->h,old.v,old.h);PenPat(gray);PenMode(patXor);VWait();FrameRect(r);while(Button())	{	GetMouse(&new);	if(!(new.h==old.h && new.v==old.v))		{		VWait();		FrameRect(r);		MaxRect(r,&rBounds,p->v,p->h,new.v,new.h);		old.v=new.v;		old.h=new.h;		VWait();		FrameRect(r);		}	}VWait();FrameRect(r);}/*----------------------------------------------------------------------  *----------------------------------------------------------------------  */MaxRect(r,b,y0,x0,y1,x1)Rect *r,*b;int x0,y0,x1,y1;{if(x0<x1)	{	r->left=x0;	r->right=x1;	}else{	r->left=x1;	r->right=x0;	}if(y0<y1)	{	r->top=y0;	r->bottom=y1;	}else{	r->top=y1;	r->bottom=y0;	}if(r->top<b->top)	{	r->bottom=b->top+(r->bottom-r->top);	r->top=b->top;	}if(r->right<b->left)	{	r->left=b->left+r->left-r->right;	r->right=b->left;	}if(r->left>b->right)	{	r->right=b->right+r->right-r->left;	r->left=b->right;	}if(r->top>b->bottom)	{	r->bottom=b->bottom+r->bottom-r->top;	r->top=b->bottom;	}}/*--------------------------------------------------------------------- *--------------------------------------------------------------------- */VWait(){long ticks;ticks=TickCount();while(ticks==TickCount());}/*--------------------------------------------------------------------- *--------------------------------------------------------------------- */doupdate(){GrafPtr	savePort;GetPort( &savePort );SetPort(theWindow);BeginUpdate(theWindow);DejaCopy();InvertRect(&dbutton[cnum]);EndUpdate(theWindow);SetPort( savePort );}/*--------------------------------------------------------------------- *--------------------------------------------------------------------- */DrawRect(){GrafPtr	savePort;Rect r;r.top=50;r.left=50;r.right=350;r.bottom=150;GetPort( &savePort );SetPort(&meta0);FrameRect(&r);SetPort( savePort );}